{"version":3,"file":"filters.min.js","sources":["../../src/js/filters.js","../../src/js/utils.js"],"sourcesContent":["// @ts-check\n\nimport { ensureElementHasId, onDomReady, onDomUpdate } from \"./utils.js\";\n\nvar initiatedFilterToggles = new WeakMap();\n\nonDomReady(initFilterToggles);\nonDomUpdate(initFilterToggles);\n\n/**\n * Add a close/open toggle behaviour to the filters. Safe to call again to\n * apply to newly added filters.\n */\nexport function initFilterToggles() {\n\tvar filterToggles = document.querySelectorAll(\".filter > div > button\");\n\tfor (var i = 0; i < filterToggles.length; i++) {\n\t\tvar filterToggle = filterToggles[i];\n\t\tif (\n\t\t\tinitiatedFilterToggles.has(filterToggle) ||\n\t\t\t!(filterToggle instanceof HTMLElement)\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\t\tinitFilterToggle(filterToggle);\n\t\tinitiatedFilterToggles.set(filterToggle, true);\n\t}\n\tdocument.body.classList.add(\"js-filters-loaded\");\n}\n\n/**\n * @param {HTMLElement} filterToggle\n */\nfunction initFilterToggle(filterToggle) {\n\tvar filter = filterToggle.parentNode.parentNode;\n\tif (!(filter instanceof HTMLElement)) {\n\t\treturn;\n\t}\n\tvar form = filter.querySelector(\"form\");\n\tif (!(form instanceof HTMLElement)) {\n\t\tconsole.error(\n\t\t\t\"Could not find <form> corresponding to filter toggle:\",\n\t\t\tfilterToggle\n\t\t);\n\t\treturn;\n\t}\n\tvar expanded = filterToggle.getAttribute(\"aria-expanded\") !== \"false\";\n\tvar hideLabel, showLabel;\n\tif (expanded) {\n\t\thideLabel = filterToggle.innerText;\n\t\tshowLabel = filterToggle.dataset.showFiltersLabel || \"Toon filters\";\n\t} else {\n\t\thideLabel = filterToggle.dataset.hideFiltersLabel || \"Verberg filters\";\n\t\tshowLabel = filterToggle.innerText;\n\t}\n\tensureElementHasId(filter);\n\tfilterToggle.setAttribute(\"aria-controls\", filter.id);\n\tif (expanded) {\n\t\tfilterToggle.setAttribute(\"aria-expanded\", \"true\");\n\t} else {\n\t\tform.setAttribute(\"hidden\", \"\");\n\t}\n\tfilterToggle.addEventListener(\"click\", function () {\n\t\tvar expand = filterToggle.getAttribute(\"aria-expanded\") == \"false\";\n\t\tfilterToggle.setAttribute(\"aria-expanded\", expand ? \"true\" : \"false\");\n\t\tfilterToggle.innerHTML = expand ? hideLabel : showLabel;\n\t\tif (expand) {\n\t\t\tform.removeAttribute(\"hidden\");\n\t\t} else {\n\t\t\tform.setAttribute(\"hidden\", \"\");\n\t\t}\n\t});\n}\n","/**\n * Run the given callback function once after the DOM is ready.\n *\n * @param {() => void} fn\n */\nexport function onDomReady(fn) {\n\tif (document.readyState !== \"loading\") return fn();\n\tdocument.addEventListener(\"DOMContentLoaded\", fn);\n}\n\n/**\n * Provide the given element with a unique generated `id`, if it does not have one already.\n *\n * @param {HTMLElement} element\n */\nexport function ensureElementHasId(element) {\n\tif (!element.id) {\n\t\telement.id =\n\t\t\telement.tagName + \"-\" + (~~(Math.random() * 1e9) + 1e9).toString(16);\n\t}\n}\n\n/**\n * Set up a matchMedia change event listener. Returns a function that, when\n * called, will remove the event listener again.\n *\n * @param {string} media\n * @param {(event: { matches: boolean }) => void} handler\n * @return {() => void}\n */\nexport function onMediaQueryMatch(media, handler) {\n\tvar mql = window.matchMedia(media);\n\n\tif (mql.addEventListener) {\n\t\tmql.addEventListener(\"change\", handler);\n\t} else {\n\t\tmql.addListener(handler);\n\t}\n\n\thandler(mql);\n\n\treturn function remove() {\n\t\tif (mql.addEventListener) {\n\t\t\tmql.removeEventListener(\"change\", handler);\n\t\t} else {\n\t\t\tmql.removeListener(handler);\n\t\t}\n\t};\n}\n\n/**\n * @param {HTMLElement} parent\n * @param {HTMLElement} child\n */\nexport function prependNode(parent, child) {\n\tvar children = parent.childNodes;\n\tif (children.length) parent.insertBefore(child, children[0]);\n\telse parent.appendChild(child);\n}\n\n/**\n * Set up a MutationObserver. Returns a disconnect function.\n * @param {() => void} handler\n * @param {HTMLElement | undefined} [root]\n * @return {undefined|() => void}\n */\nexport function onDomUpdate(handler, root) {\n\tif (\"MutationObserver\" in window) {\n\t\tvar observer = new MutationObserver(handler);\n\t\tobserver.observe(root || document, { childList: true, subtree: true });\n\t\treturn observer.disconnect.bind(observer);\n\t}\n}\n\n/**\n * Ponyfill for Element.prototype.closest.\n * @param {Element} element\n * @param {DOMString} selectors\n * @return {Element | null}\n */\nexport function closest(element, selectors) {\n\tif (Element.prototype.closest) {\n\t\treturn element.closest(selectors);\n\t}\n\tvar matches =\n\t\tElement.prototype.matches ||\n\t\tElement.prototype.msMatchesSelector ||\n\t\tElement.prototype.webkitMatchesSelector;\n\n\tdo {\n\t\tif (matches.call(element, selectors)) {\n\t\t\treturn element;\n\t\t}\n\t\telement = element.parentElement || element.parentNode;\n\t} while (element !== null && element.nodeType === 1);\n\n\treturn null;\n}\n"],"names":["initiatedFilterToggles","WeakMap","initFilterToggles","filterToggles","document","querySelectorAll","i","length","filterToggle","has","HTMLElement","initFilterToggle","set","body","classList","add","filter","parentNode","form","querySelector","hideLabel","showLabel","element","expanded","getAttribute","innerText","dataset","showFiltersLabel","hideFiltersLabel","id","tagName","Math","random","toString","setAttribute","addEventListener","expand","innerHTML","removeAttribute","console","error","fn","readyState","onDomReady","handler","root","window","observer","MutationObserver","observe","childList","subtree","disconnect","bind","onDomUpdate"],"mappings":"gCAIA,IAAIA,uBAAyB,IAAIC,QAS1B,SAASC,oBAEf,IADA,IAAIC,cAAgBC,SAASC,iBAAiB,0BACrCC,EAAI,EAAGA,EAAIH,cAAcI,OAAQD,IAAK,CAC9C,IAAIE,aAAeL,cAAcG,IAEhCN,uBAAuBS,IAAID,eACzBA,wBAAwBE,cAI3BC,iBAAiBH,cACjBR,uBAAuBY,IAAIJ,cAAc,IAE1CJ,SAASS,KAAKC,UAAUC,IAAI,qBAM7B,SAASJ,iBAAiBH,cACzB,IAAIQ,OAASR,aAAaS,WAAWA,WACrC,GAAMD,kBAAkBN,YAAxB,CAGA,IAAIQ,KAAOF,OAAOG,cAAc,QAChC,GAAMD,gBAAgBR,YAAtB,CAOA,IACIU,UAAWC,UC/BmBC,QD8B9BC,SAA0D,UAA/Cf,aAAagB,aAAa,iBAErCD,UACHH,UAAYZ,aAAaiB,UACzBJ,UAAYb,aAAakB,QAAQC,kBAAoB,iBAErDP,UAAYZ,aAAakB,QAAQE,kBAAoB,kBACrDP,UAAYb,aAAaiB,YCrCQH,QDuCfN,QCtCNa,KACZP,QAAQO,GACPP,QAAQQ,QAAU,KAAiC,OAAP,IAAhBC,KAAKC,WAAuBC,SAAS,KDqCnEzB,aAAa0B,aAAa,gBAAiBlB,OAAOa,IAC9CN,SACHf,aAAa0B,aAAa,gBAAiB,QAE3ChB,KAAKgB,aAAa,SAAU,IAE7B1B,aAAa2B,iBAAiB,SAAS,WACtC,IAAIC,OAAuD,SAA9C5B,aAAagB,aAAa,iBACvChB,aAAa0B,aAAa,gBAAiBE,OAAS,OAAS,SAC7D5B,aAAa6B,UAAYD,OAAShB,UAAYC,UAC1Ce,OACHlB,KAAKoB,gBAAgB,UAErBpB,KAAKgB,aAAa,SAAU,YA7B7BK,QAAQC,MACP,wDACAhC,gBCpCI,SAAoBiC,IAC1B,GAA4B,YAAxBrC,SAASsC,WAA0B,OAAOD,KAC9CrC,SAAS+B,iBAAiB,mBAAoBM,KDD/CE,CAAWzC,mBC4DJ,SAAqB0C,QAASC,MACpC,GAAI,qBAAsBC,OAAQ,CACjC,IAAIC,SAAW,IAAIC,iBAAiBJ,SACpCG,SAASE,QAAQJ,MAAQzC,SAAU,CAAE8C,WAAW,EAAMC,SAAS,IACxDJ,SAASK,WAAWC,KAAKN,WD/DlCO,CAAYpD"}