{"version":3,"file":"accordion.min.js","sources":["../../src/js/accordion.js","../../src/js/utils.js"],"sourcesContent":["// @ts-check\n\nimport { ensureElementHasId, onDomReady, onDomUpdate } from \"./utils.js\";\n\nvar initiatedAccordions = new WeakMap();\n\nonDomReady(initAccordions);\nonDomUpdate(initAccordions);\n\nfunction initAccordions() {\n\tvar accordions = document.querySelectorAll(\".accordion\");\n\tfor (var i = 0; i < accordions.length; i++) {\n\t\tvar accordion = accordions[i];\n\t\tif (initiatedAccordions.has(accordion)) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (!(accordion instanceof HTMLElement)) {\n\t\t\tcontinue;\n\t\t}\n\t\tinitAccordion(accordion);\n\t\tinitiatedAccordions.set(accordion, true);\n\t}\n\tdocument.body.classList.add(\"js-accordion-loaded\");\n}\n\n/**\n * @param {HTMLElement} accordion\n */\nfunction initAccordion(accordion) {\n\tvar hasAriaExpandedMarkup = false;\n\tvar buttons = getButtons(accordion);\n\n\tfor (var i = 0; i < buttons.length; i++) {\n\t\tvar button = buttons[i];\n\n\t\t// Make sure the button `aria-control`s its sibling <div> by id.\n\t\tif (!button.getAttribute(\"aria-controls\")) {\n\t\t\tvar sibling = button.nextElementSibling;\n\t\t\tif (!(sibling instanceof HTMLElement) || sibling.tagName !== \"DIV\") {\n\t\t\t\tconsole.error(\"No sibling <div> found for accordion button:\", button);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tensureElementHasId(sibling);\n\t\t\tbutton.setAttribute(\"aria-controls\", sibling.id);\n\t\t}\n\n\t\t// Set up the initial `aria-expanded` state.\n\t\tif (button.getAttribute(\"aria-expanded\")) {\n\t\t\thasAriaExpandedMarkup = true;\n\t\t} else {\n\t\t\tbutton.setAttribute(\"aria-expanded\", \"false\");\n\t\t}\n\n\t\tbutton.addEventListener(\"click\", function (event) {\n\t\t\tvar target = event.target;\n\t\t\tif (!(target instanceof HTMLElement)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar expanded = target.getAttribute(\"aria-expanded\") === \"true\";\n\t\t\ttarget.setAttribute(\"aria-expanded\", expanded ? \"false\" : \"true\");\n\t\t});\n\t}\n\n\t// Expand the first item by default\n\tif (!hasAriaExpandedMarkup) {\n\t\tbuttons[0].setAttribute(\"aria-expanded\", \"true\");\n\t}\n}\n\n/**\n * @param {HTMLElement} accordion\n */\nfunction getButtons(accordion) {\n\tvar buttons = [];\n\tfor (var i = 0; i < accordion.children.length; i++) {\n\t\tvar container = accordion.children[i];\n\t\tfor (var j = 0; j < container.children.length; j++) {\n\t\t\tvar child = container.children[j];\n\t\t\tif (child.tagName === \"BUTTON\") {\n\t\t\t\tbuttons.push(child);\n\t\t\t}\n\t\t}\n\t}\n\treturn buttons;\n}\n","/**\n * Run the given callback function once after the DOM is ready.\n *\n * @param {() => void} fn\n */\nexport function onDomReady(fn) {\n\tif (document.readyState !== \"loading\") return fn();\n\tdocument.addEventListener(\"DOMContentLoaded\", fn);\n}\n\n/**\n * Provide the given element with a unique generated `id`, if it does not have one already.\n *\n * @param {HTMLElement} element\n */\nexport function ensureElementHasId(element) {\n\tif (!element.id) {\n\t\telement.id =\n\t\t\telement.tagName + \"-\" + (~~(Math.random() * 1e9) + 1e9).toString(16);\n\t}\n}\n\n/**\n * Set up a matchMedia change event listener. Returns a function that, when\n * called, will remove the event listener again.\n *\n * @param {string} media\n * @param {(event: { matches: boolean }) => void} handler\n * @return {() => void}\n */\nexport function onMediaQueryMatch(media, handler) {\n\tvar mql = window.matchMedia(media);\n\n\tif (mql.addEventListener) {\n\t\tmql.addEventListener(\"change\", handler);\n\t} else {\n\t\tmql.addListener(handler);\n\t}\n\n\thandler(mql);\n\n\treturn function remove() {\n\t\tif (mql.addEventListener) {\n\t\t\tmql.removeEventListener(\"change\", handler);\n\t\t} else {\n\t\t\tmql.removeListener(handler);\n\t\t}\n\t};\n}\n\n/**\n * @param {HTMLElement} parent\n * @param {HTMLElement} child\n */\nexport function prependNode(parent, child) {\n\tvar children = parent.childNodes;\n\tif (children.length) parent.insertBefore(child, children[0]);\n\telse parent.appendChild(child);\n}\n\n/**\n * Set up a MutationObserver. Returns a disconnect function.\n * @param {() => void} handler\n * @param {HTMLElement | undefined} [root]\n * @return {undefined|() => void}\n */\nexport function onDomUpdate(handler, root) {\n\tif (\"MutationObserver\" in window) {\n\t\tvar observer = new MutationObserver(handler);\n\t\tobserver.observe(root || document, { childList: true, subtree: true });\n\t\treturn observer.disconnect.bind(observer);\n\t}\n}\n\n/**\n * Ponyfill for Element.prototype.closest.\n * @param {Element} element\n * @param {DOMString} selectors\n * @return {Element | null}\n */\nexport function closest(element, selectors) {\n\tif (Element.prototype.closest) {\n\t\treturn element.closest(selectors);\n\t}\n\tvar matches =\n\t\tElement.prototype.matches ||\n\t\tElement.prototype.msMatchesSelector ||\n\t\tElement.prototype.webkitMatchesSelector;\n\n\tdo {\n\t\tif (matches.call(element, selectors)) {\n\t\t\treturn element;\n\t\t}\n\t\telement = element.parentElement || element.parentNode;\n\t} while (element !== null && element.nodeType === 1);\n\n\treturn null;\n}\n"],"names":["initiatedAccordions","WeakMap","initAccordions","accordions","document","querySelectorAll","i","length","accordion","has","HTMLElement","initAccordion","set","body","classList","add","element","hasAriaExpandedMarkup","buttons","children","container","j","child","tagName","push","getButtons","button","getAttribute","sibling","nextElementSibling","console","error","id","Math","random","toString","setAttribute","addEventListener","event","target","expanded","fn","readyState","onDomReady","handler","root","window","observer","MutationObserver","observe","childList","subtree","disconnect","bind","onDomUpdate"],"mappings":"yBAIA,IAAIA,oBAAsB,IAAIC,QAK9B,SAASC,iBAER,IADA,IAAIC,WAAaC,SAASC,iBAAiB,cAClCC,EAAI,EAAGA,EAAIH,WAAWI,OAAQD,IAAK,CAC3C,IAAIE,UAAYL,WAAWG,GACvBN,oBAAoBS,IAAID,YAGtBA,qBAAqBE,cAG3BC,cAAcH,WACdR,oBAAoBY,IAAIJ,WAAW,IAEpCJ,SAASS,KAAKC,UAAUC,IAAI,uBAM7B,SAASJ,cAAcH,WAItB,IAHA,ICdkCQ,QDc9BC,uBAAwB,EACxBC,QA0CL,SAAoBV,WAEnB,IADA,IAAIU,QAAU,GACLZ,EAAI,EAAGA,EAAIE,UAAUW,SAASZ,OAAQD,IAE9C,IADA,IAAIc,UAAYZ,UAAUW,SAASb,GAC1Be,EAAI,EAAGA,EAAID,UAAUD,SAASZ,OAAQc,IAAK,CACnD,IAAIC,MAAQF,UAAUD,SAASE,GACT,WAAlBC,MAAMC,SACTL,QAAQM,KAAKF,OAIhB,OAAOJ,QArDOO,CAAWjB,WAEhBF,EAAI,EAAGA,EAAIY,QAAQX,OAAQD,IAAK,CACxC,IAAIoB,OAASR,QAAQZ,GAGrB,IAAKoB,OAAOC,aAAa,iBAAkB,CAC1C,IAAIC,QAAUF,OAAOG,mBACrB,KAAMD,mBAAmBlB,cAAoC,QAApBkB,QAAQL,QAAmB,CACnEO,QAAQC,MAAM,+CAAgDL,QAC9D,UCzB+BV,QD2BbY,SC1BRI,KACZhB,QAAQgB,GACPhB,QAAQO,QAAU,KAAiC,OAAP,IAAhBU,KAAKC,WAAuBC,SAAS,KDyBjET,OAAOU,aAAa,gBAAiBR,QAAQI,IAI1CN,OAAOC,aAAa,iBACvBV,uBAAwB,EAExBS,OAAOU,aAAa,gBAAiB,SAGtCV,OAAOW,iBAAiB,SAAS,SAAUC,OAC1C,IAAIC,OAASD,MAAMC,OACnB,GAAMA,kBAAkB7B,YAAxB,CAGA,IAAI8B,SAAoD,SAAzCD,OAAOZ,aAAa,iBACnCY,OAAOH,aAAa,gBAAiBI,SAAW,QAAU,YAKvDvB,uBACJC,QAAQ,GAAGkB,aAAa,gBAAiB,SC5DpC,SAAoBK,IAC1B,GAA4B,YAAxBrC,SAASsC,WAA0B,OAAOD,KAC9CrC,SAASiC,iBAAiB,mBAAoBI,IDD/CE,CAAWzC,gBC4DJ,SAAqB0C,QAASC,MACpC,GAAI,qBAAsBC,OAAQ,CACjC,IAAIC,SAAW,IAAIC,iBAAiBJ,SACpCG,SAASE,QAAQJ,MAAQzC,SAAU,CAAE8C,WAAW,EAAMC,SAAS,IACxDJ,SAASK,WAAWC,KAAKN,WD/DlCO,CAAYpD"}