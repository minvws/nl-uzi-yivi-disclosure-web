{"version":3,"file":"expando-rows.min.js","sources":["../../src/js/utils.js","../../src/js/expando-rows.js"],"sourcesContent":["/**\n * Run the given callback function once after the DOM is ready.\n *\n * @param {() => void} fn\n */\nexport function onDomReady(fn) {\n\tif (document.readyState !== \"loading\") return fn();\n\tdocument.addEventListener(\"DOMContentLoaded\", fn);\n}\n\n/**\n * Provide the given element with a unique generated `id`, if it does not have one already.\n *\n * @param {HTMLElement} element\n */\nexport function ensureElementHasId(element) {\n\tif (!element.id) {\n\t\telement.id =\n\t\t\telement.tagName + \"-\" + (~~(Math.random() * 1e9) + 1e9).toString(16);\n\t}\n}\n\n/**\n * Set up a matchMedia change event listener. Returns a function that, when\n * called, will remove the event listener again.\n *\n * @param {string} media\n * @param {(event: { matches: boolean }) => void} handler\n * @return {() => void}\n */\nexport function onMediaQueryMatch(media, handler) {\n\tvar mql = window.matchMedia(media);\n\n\tif (mql.addEventListener) {\n\t\tmql.addEventListener(\"change\", handler);\n\t} else {\n\t\tmql.addListener(handler);\n\t}\n\n\thandler(mql);\n\n\treturn function remove() {\n\t\tif (mql.addEventListener) {\n\t\t\tmql.removeEventListener(\"change\", handler);\n\t\t} else {\n\t\t\tmql.removeListener(handler);\n\t\t}\n\t};\n}\n\n/**\n * @param {HTMLElement} parent\n * @param {HTMLElement} child\n */\nexport function prependNode(parent, child) {\n\tvar children = parent.childNodes;\n\tif (children.length) parent.insertBefore(child, children[0]);\n\telse parent.appendChild(child);\n}\n\n/**\n * Set up a MutationObserver. Returns a disconnect function.\n * @param {() => void} handler\n * @param {HTMLElement | undefined} [root]\n * @return {undefined|() => void}\n */\nexport function onDomUpdate(handler, root) {\n\tif (\"MutationObserver\" in window) {\n\t\tvar observer = new MutationObserver(handler);\n\t\tobserver.observe(root || document, { childList: true, subtree: true });\n\t\treturn observer.disconnect.bind(observer);\n\t}\n}\n\n/**\n * Ponyfill for Element.prototype.closest.\n * @param {Element} element\n * @param {DOMString} selectors\n * @return {Element | null}\n */\nexport function closest(element, selectors) {\n\tif (Element.prototype.closest) {\n\t\treturn element.closest(selectors);\n\t}\n\tvar matches =\n\t\tElement.prototype.matches ||\n\t\tElement.prototype.msMatchesSelector ||\n\t\tElement.prototype.webkitMatchesSelector;\n\n\tdo {\n\t\tif (matches.call(element, selectors)) {\n\t\t\treturn element;\n\t\t}\n\t\telement = element.parentElement || element.parentNode;\n\t} while (element !== null && element.nodeType === 1);\n\n\treturn null;\n}\n","// @ts-check\n\nimport {\n\tclosest,\n\tensureElementHasId,\n\tonDomReady,\n\tonDomUpdate,\n} from \"./utils.js\";\n\nvar managedTables = new WeakMap();\n\nonDomReady(initExpandoRows);\nonDomUpdate(initExpandoRows);\n\n/**\n * Add a close/open toggle behaviour to expando-rows. Safe to call again to\n * apply to newly added expando-rows.\n */\nexport function initExpandoRows() {\n\tvar tables = document.querySelectorAll(\"table\");\n\tfor (var i = 0; i < tables.length; i++) {\n\t\tvar table = tables[i];\n\t\tif (!(table instanceof HTMLElement)) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (\n\t\t\t!(table instanceof HTMLElement) ||\n\t\t\t!table.querySelector(\".expando-button\") ||\n\t\t\tmanagedTables.has(table)\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\t\tinitTable(table);\n\t\tmanagedTables.set(table, true);\n\t}\n\tdocument.body.classList.add(\"js-expando-rows-loaded\");\n}\n\n/**\n * Start managing the table's expando-buttons, their corresponding\n * expando-rows, and the zebra striping of the other rows.\n * @param {HTMLElement} table\n */\nfunction initTable(table) {\n\tinitExpandoButtons(table);\n\tupdateZebra(table);\n\tonDomUpdate(function () {\n\t\tinitExpandoButtons(table);\n\t\tupdateZebra(table);\n\t}, table);\n}\n\n/**\n * Setup the table's expando-buttons to handle clicks and control their\n * corresponding expando-rows. Safe to call again to apply to newly added\n * expando-buttons.\n * @param {HTMLElement} table\n */\nfunction initExpandoButtons(table) {\n\tvar buttons = table.querySelectorAll(\".expando-button\");\n\tfor (var i = 0; i < buttons.length; i++) {\n\t\tvar button = buttons[i];\n\t\tif (\n\t\t\t!(button instanceof HTMLElement) ||\n\t\t\tbutton.hasAttribute(\"aria-controls\") ||\n\t\t\tbutton.hasAttribute(\"disabled\")\n\t\t) {\n\t\t\tcontinue;\n\t\t}\n\t\tinitExpandoButton(button);\n\t}\n}\n\n/**\n * Setup an expando-buttons to handle clicks and control its corresponding\n * expando-row.\n * @param {HTMLElement} button\n */\nfunction initExpandoButton(button) {\n\tvar buttonRow = closest(button, \"tr\");\n\tvar row = buttonRow.nextElementSibling;\n\tif (\n\t\t!(row instanceof HTMLElement) ||\n\t\t!(row.tagName === \"TR\") ||\n\t\t!row.classList.contains(\"expando-row\")\n\t) {\n\t\tconsole.warn(\n\t\t\t\"Could not find .expando-row corresponding to .expando-button:\",\n\t\t\tbutton\n\t\t);\n\t\tbutton.setAttribute(\"disabled\", \"\");\n\t\tbutton.classList.add(\n\t\t\t\"action-button\",\n\t\t\t\"ro-icon\",\n\t\t\t\"ro-icon-chevron-light-bottom\"\n\t\t);\n\t\treturn;\n\t}\n\n\tvar expanded = button.getAttribute(\"aria-expanded\") === \"true\";\n\tvar closeLabel, openLabel;\n\tif (expanded) {\n\t\tcloseLabel = button.innerText;\n\t\topenLabel = button.dataset.openLabel || \"Open details\";\n\t\tbutton.setAttribute(\"aria-expanded\", \"true\");\n\t} else {\n\t\tcloseLabel = button.dataset.closeLabel || \"Sluit details\";\n\t\topenLabel = button.innerText;\n\t\tbutton.setAttribute(\"aria-expanded\", \"false\");\n\t\trow.setAttribute(\"hidden\", \"\");\n\t}\n\n\tensureElementHasId(row);\n\tbutton.setAttribute(\"aria-controls\", row.id);\n\tbutton.classList.add(\n\t\t\"action-button\",\n\t\t\"ro-icon\",\n\t\texpanded ? \"ro-icon-chevron-light-top\" : \"ro-icon-chevron-light-bottom\"\n\t);\n\n\tbutton.addEventListener(\"click\", function () {\n\t\tvar expand = button.getAttribute(\"aria-expanded\") === \"false\";\n\t\tbutton.setAttribute(\"aria-expanded\", expand ? \"true\" : \"false\");\n\t\tif (expand) {\n\t\t\tbutton.innerHTML = closeLabel;\n\t\t\tbutton.classList.remove(\"ro-icon-chevron-light-bottom\");\n\t\t\tbutton.classList.add(\"ro-icon-chevron-light-top\");\n\t\t\trow.removeAttribute(\"hidden\");\n\t\t} else {\n\t\t\tbutton.innerHTML = openLabel;\n\t\t\tbutton.classList.remove(\"ro-icon-chevron-light-top\");\n\t\t\tbutton.classList.add(\"ro-icon-chevron-light-bottom\");\n\t\t\trow.setAttribute(\"hidden\", \"\");\n\t\t}\n\t});\n}\n\n/**\n * Update the rows' .odd/.even override classes.\n * @param {HTMLElement} table\n */\nfunction updateZebra(table) {\n\tvar rows = table.querySelectorAll(\"tr:not(.expando-row)\");\n\tfor (var i = 0; i < rows.length; i++) {\n\t\tvar row = rows[i];\n\t\tif (i % 2) {\n\t\t\trow.classList.add(\"odd\");\n\t\t\trow.classList.remove(\"even\");\n\t\t} else {\n\t\t\trow.classList.add(\"even\");\n\t\t\trow.classList.remove(\"odd\");\n\t\t}\n\t}\n}\n"],"names":["onDomUpdate","handler","root","window","observer","MutationObserver","observe","document","childList","subtree","disconnect","bind","managedTables","WeakMap","initExpandoRows","tables","querySelectorAll","i","length","table","HTMLElement","querySelector","has","initTable","set","body","classList","add","initExpandoButtons","updateZebra","buttons","button","hasAttribute","initExpandoButton","row","element","selectors","Element","prototype","closest","matches","msMatchesSelector","webkitMatchesSelector","call","parentElement","parentNode","nodeType","nextElementSibling","tagName","contains","console","warn","setAttribute","closeLabel","openLabel","expanded","getAttribute","innerText","dataset","id","Math","random","toString","addEventListener","expand","innerHTML","remove","removeAttribute","rows","fn","readyState","onDomReady"],"mappings":"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"}